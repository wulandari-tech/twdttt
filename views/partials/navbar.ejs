<style>
:root {
    --font-family-main: 'Poppins', sans-serif;
    --primary-color: #6E41E2;
    --primary-light-color: #8A63E9;
    --primary-dark-color: #5630B0;
    --accent-color: #FF6B6B;
    --text-on-primary: #FFFFFF;
    --bg-surface: #FFFFFF;
    --text-dark: #2A2F40;
    --text-medium: #5A6173;
    --border-color-light: #E0E0E0;
    --border-radius-sm: 0.3rem;
    --border-radius-md: 0.5rem;
    --shadow-md: 0 5px 15px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
    --header-height: 70px;
    --transition-speed: 0.3s;
    --sidebar-width: 280px; /* Lebar sidebar off-canvas */
}

/* --- Site Navbar Styles --- */
.site-navbar {
    background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-dark-color) 100%);
    box-shadow: var(--shadow-md);
    padding-top: 0.6rem; padding-bottom: 0.6rem;
    min-height: var(--header-height);
    transition: background-color var(--transition-speed) ease;
    position: fixed; top: 0; left: 0; right: 0; z-index: 1030;
}
.site-navbar .navbar-brand { font-size: 1.5rem; color: var(--text-on-primary) !important; font-weight: 700; letter-spacing: 0.5px; }
.site-navbar .navbar-brand i { color: var(--accent-color); }
.site-navbar .nav-link {
    color: rgba(255, 255, 255, 0.8) !important; font-weight: 500;
    padding: 0.6rem 1rem !important; border-radius: var(--border-radius-sm);
    transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease;
    display: flex; align-items: center; position: relative;
}
.site-navbar .nav-link i.fa-fw { width: 1.25em; text-align: center; }
.site-navbar .nav-link:hover, .site-navbar .nav-link:focus { color: #fff !important; background-color: rgba(255, 255, 255, 0.1); transform: translateY(-2px); }
.site-navbar .nav-link.active { color: #fff !important; font-weight: 600; background-color: rgba(255, 255, 255, 0.15); }

.site-navbar .btn-accent {
    background-color: var(--accent-color); border-color: var(--accent-color); color: var(--text-on-primary);
    padding: 0.4rem 0.8rem; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.5px; border-radius: var(--border-radius-md); transition: all var(--transition-speed) ease;
}
.site-navbar .btn-accent:hover { background-color: var(--accent-hover-color); border-color: var(--accent-hover-color); transform: translateY(-2px); box-shadow: var(--shadow-sm); }
.site-navbar .btn-accent i { margin-right: 0.5em; }

.site-navbar .user-dropdown-toggler .user-avatar-sm { width: 34px; height: 34px; border: 2px solid rgba(255,255,255,0.3); object-fit: cover; }
.site-navbar .user-dropdown-toggler:hover .user-avatar-sm { border-color: #fff; }
.site-navbar .user-dropdown-toggler .fa-user-circle { font-size: 1.75rem; opacity: 0.85; }
.site-navbar .user-dropdown-toggler:hover .fa-user-circle { opacity: 1; }
.site-navbar .user-name-nav { max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: inline-block; vertical-align: middle; }

.site-navbar .dropdown-menu {
    border-radius: var(--border-radius-md); border: 1px solid var(--border-color-light);
    box-shadow: var(--shadow-lg); margin-top: 0.65rem !important; min-width: 230px;
    background-color: var(--bg-surface); padding: 0.5rem 0; animation: fadeInDropdown 0.2s ease-out;
}
@keyframes fadeInDropdown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
.site-navbar .dropdown-item {
    padding: 0.65rem 1.25rem; font-weight: 500; color: var(--text-medium);
    display: flex; align-items: center; border-radius: var(--border-radius-sm);
    margin: 0.1rem 0.5rem; width: calc(100% - 1rem); transition: all var(--transition-speed);
}
.site-navbar .dropdown-item i.fa-fw { color: var(--text-medium); width: 1.6em; }
.site-navbar .dropdown-item:hover, .site-navbar .dropdown-item:focus { background-color: var(--primary-color); color: var(--text-on-primary) !important; transform: translateX(3px); }
.site-navbar .dropdown-item:hover i.fa-fw, .site-navbar .dropdown-item:focus i.fa-fw { color: var(--text-on-primary); }
.site-navbar .dropdown-item.text-danger { color: var(--accent-color) !important; }
.site-navbar .dropdown-item.text-danger:hover, .site-navbar .dropdown-item.text-danger:focus { background-color: var(--accent-color); color: var(--text-on-primary) !important; }
.site-navbar .dropdown-item.text-danger:hover i.fa-fw, .site-navbar .dropdown-item.text-danger:focus i.fa-fw { color: var(--text-on-primary); }
.site-navbar .dropdown-divider { border-top: 1px solid var(--border-color-light); margin: 0.5rem 0.5rem; }

.site-navbar .navbar-toggler { /* Tombol hamburger utama Bootstrap */
    border: 1px solid rgba(255,255,255,0.4); padding: 0.35rem 0.6rem;
    transition: background-color 0.2s ease; margin-left: 0.5rem; /* Beri jarak jika ada main menu toggle */
}
.site-navbar .navbar-toggler:hover { background-color: rgba(255,255,255,0.1); }
.site-navbar .navbar-toggler:focus { box-shadow: 0 0 0 0.2rem rgba(255,255,255,0.25); }
.site-navbar .navbar-toggler-icon { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(255, 255, 255, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2.5' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e"); width: 1.3em; height: 1.3em; }

/* Tombol untuk Main Menu Sidebar (jika berbeda dari toggler Bootstrap) */
.main-menu-toggler {
    color: var(--text-on-primary);
    background-color: transparent;
    border: 1px solid rgba(255,255,255,0.4);
    padding: 0.35rem 0.7rem;
    font-size: 1.2rem; /* Ukuran ikon */
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: background-color 0.2s ease;
}
.main-menu-toggler:hover {
    background-color: rgba(255,255,255,0.1);
}

/* --- MAIN MENU SIDEBAR (Off-Canvas) --- */
.main-menu-sidebar {
    position: fixed;
    top: 0;
    left: calc(-1 * var(--sidebar-width)); /* Mulai dari luar layar kiri */
    width: var(--sidebar-width);
    height: 100vh;
    background-color: var(--primary-dark-color); /* Warna sidebar */
    color: var(--text-on-primary);
    padding-top: 1.5rem;
    box-shadow: var(--shadow-lg);
    z-index: 1040; /* Di atas navbar, di bawah modal */
    transition: left var(--transition-speed) cubic-bezier(0.25, 0.8, 0.25, 1);
    overflow-y: auto;
}
.main-menu-sidebar.open {
    left: 0; /* Munculkan sidebar */
}
.main-menu-sidebar .sidebar-header {
    padding: 0 1.5rem 1.5rem 1.5rem;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.main-menu-sidebar .sidebar-brand {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--text-on-primary);
    text-decoration: none;
}
.main-menu-sidebar .sidebar-brand i { color: var(--accent-color); }
.main-menu-sidebar .close-sidebar-btn {
    color: var(--text-on-primary);
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    opacity: 0.8;
    transition: opacity var(--transition-speed) ease;
}
.main-menu-sidebar .close-sidebar-btn:hover { opacity: 1; }

.main-menu-sidebar .sidebar-nav { list-style: none; padding: 0; margin: 0; }
.main-menu-sidebar .sidebar-nav .nav-item { width: 100%; }
.main-menu-sidebar .sidebar-nav .nav-link {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    color: rgba(255,255,255,0.8);
    font-weight: 500;
    text-decoration: none;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    transition: background-color 0.2s ease, color 0.2s ease;
}
.main-menu-sidebar .sidebar-nav .nav-link i.fa-fw { width: 1.5em; margin-right: 0.8em; font-size: 1.1em; }
.main-menu-sidebar .sidebar-nav .nav-link:hover { background-color: rgba(255,255,255,0.1); color: #fff; }
.main-menu-sidebar .sidebar-nav .nav-link.active { background-color: rgba(255,255,255,0.15); color: #fff; font-weight: 600; }

/* Overlay untuk background saat sidebar terbuka */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    z-index: 1035; /* Di bawah sidebar, di atas konten */
    opacity: 0;
    visibility: hidden;
    transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
}
.sidebar-overlay.show {
    opacity: 1;
    visibility: visible;
}

@media (max-width: 991.98px) {
    .site-navbar .navbar-collapse { /* Ini untuk dropdown bawaan Bootstrap jika masih ada */
        background-color: var(--primary-dark-color);
        margin-top: 0; 
        border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
        padding: 0.5rem 0;
        box-shadow: var(--shadow-lg);
        width: 100%;
        position: absolute;
        left: 0;
        top: 100%; /* Menempel di bawah navbar */
        z-index: 1020;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.35s ease-out, padding 0.35s ease-out;
    }
    .site-navbar .navbar-collapse.show {
        max-height: 75vh;
        padding: 0.5rem 0;
        overflow-y: auto;
    }
}
body {
    padding-top: var(--header-height);
}
</style>
<nav class="navbar navbar-expand-lg fixed-top site-navbar">
    <div class="container">
        <button class="main-menu-toggler d-lg-none me-2" type="button" id="mainMenuToggler" aria-label="Toggle Main Menu">
            <i class="fas fa-bars"></i>
        </button>
        <a class="navbar-brand fw-bold" href="/">
            <i class="fas fa-graduation-cap me-2"></i>WFC COURSE
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarAuthContent" aria-controls="navbarAuthContent" aria-expanded="false" aria-label="Toggle User Menu">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarAuthContent"> 
            <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-none d-lg-flex">
                <li class="nav-item">
                    <a class="nav-link <%= currentPath === '/' ? 'active' : '' %>" aria-current="page" href="/">
                        <i class="fas fa-home fa-fw me-1"></i>Beranda
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link <%= currentPath && currentPath.startsWith('/courses') ? 'active' : '' %>" href="/courses">
                        <i class="fas fa-book-open fa-fw me-1"></i>Kursus
                    </a>
                </li>
                <% if (currentUser && currentUser.role === 'admin') { %>
                    <li class="nav-item">
                        <a class="nav-link <%= currentPath && currentPath.startsWith('/admin') ? 'active' : '' %>" href="/admin">
                            <i class="fas fa-shield-alt fa-fw me-1"></i>Admin Panel
                        </a>
                    </li>
                <% } %>
            </ul>
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
                <% if (currentUser) { %>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center user-dropdown-toggler" href="#" id="navbarUserDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <% if (currentUser.avatarUrl) { %>
                                <img src="<%= currentUser.avatarUrl %>" alt="<%= currentUser.name %>" class="user-avatar-sm me-2 rounded-circle">
                            <% } else { %>
                                <i class="fas fa-user-circle fa-lg me-2"></i>
                            <% } %>
                            <span class="user-name-nav"><%= currentUser.name %></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 mt-2" aria-labelledby="navbarUserDropdown">
                            <li><a class="dropdown-item" href="/user/dashboard"><i class="fas fa-tachometer-alt fa-fw me-2"></i>Dashboard Saya</a></li>
                            <li><a class="dropdown-item" href="/user/profile/edit"><i class="fas fa-user-edit fa-fw me-2"></i>Edit Profil</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="/auth/logout"><i class="fas fa-sign-out-alt fa-fw me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                <% } else { %>
                    <li class="nav-item">
                        <a class="nav-link <%= currentPath === '/auth/login' ? 'active' : '' %>" href="/auth/login">
                           <i class="fas fa-sign-in-alt fa-fw me-1"></i>Login
                        </a>
                    </li>
                    <li class="nav-item ms-lg-2">
                        <a class="btn btn-accent btn-sm" href="/auth/register">
                            <i class="fas fa-user-plus fa-fw me-1"></i>Daftar
                        </a>
                    </li>
                <% } %>
            </ul>
        </div>
    </div>
</nav>

<!-- Main Menu Sidebar (Off-Canvas) -->
<aside class="main-menu-sidebar" id="mainMenuSidebar">
    <div class="sidebar-header">
        <a class="sidebar-brand" href="/">
            <i class="fas fa-graduation-cap me-2"></i>WFC Course
        </a>
        <button class="close-sidebar-btn" id="closeMenuSidebarBtn" aria-label="Close Main Menu">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <ul class="sidebar-nav">
        <li class="nav-item">
            <a class="nav-link <%= currentPath === '/' ? 'active' : '' %>" href="/">
                <i class="fas fa-home fa-fw"></i>Beranda
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link <%= currentPath && currentPath.startsWith('/courses') ? 'active' : '' %>" href="/courses">
                <i class="fas fa-book-open fa-fw"></i>Kursus
            </a>
        </li>
        <% if (currentUser && currentUser.role === 'admin') { %>
            <li class="nav-item">
                <a class="nav-link <%= currentPath && currentPath.startsWith('/admin') ? 'active' : '' %>" href="/admin">
                    <i class="fas fa-shield-alt fa-fw"></i>Admin Panel
                </a>
            </li>
        <% } %>
        <% if (currentUser) { %>
            <li class="nav-item mt-auto pt-3 border-top border-light opacity-25">
                <a class="nav-link" href="/user/dashboard">
                    <i class="fas fa-tachometer-alt fa-fw"></i>Dashboard Saya
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/user/profile/edit">
                    <i class="fas fa-user-edit fa-fw"></i>Edit Profil
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/auth/logout" style="color: var(--accent-color);">
                    <i class="fas fa-sign-out-alt fa-fw"></i>Logout
                </a>
            </li>
        <% } else { %>
             <li class="nav-item mt-auto pt-3 border-top border-light opacity-25">
                <a class="nav-link" href="/auth/login">
                    <i class="fas fa-sign-in-alt fa-fw"></i>Login
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/auth/register">
                    <i class="fas fa-user-plus fa-fw"></i>Daftar
                </a>
            </li>
        <% } %>
    </ul>
</aside>
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<script>
    // Skrip ini sebaiknya ada di file JS eksternal (misal, main.js)
    // Tapi untuk memenuhi permintaan, saya letakkan di sini.
    document.addEventListener('DOMContentLoaded', function () {
        const mainMenuToggler = document.getElementById('mainMenuToggler');
        const mainMenuSidebar = document.getElementById('mainMenuSidebar');
        const closeMenuSidebarBtn = document.getElementById('closeMenuSidebarBtn');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const body = document.body;

        function openSidebar() {
            if (mainMenuSidebar && sidebarOverlay) {
                mainMenuSidebar.classList.add('open');
                sidebarOverlay.classList.add('show');
                body.style.overflow = 'hidden'; // Mencegah scroll body saat sidebar terbuka
            }
        }

        function closeSidebar() {
            if (mainMenuSidebar && sidebarOverlay) {
                mainMenuSidebar.classList.remove('open');
                sidebarOverlay.classList.remove('show');
                body.style.overflow = ''; // Kembalikan scroll body
            }
        }

        if (mainMenuToggler) {
            mainMenuToggler.addEventListener('click', openSidebar);
        }

        if (closeMenuSidebarBtn) {
            closeMenuSidebarBtn.addEventListener('click', closeSidebar);
        }

        if (sidebarOverlay) {
            sidebarOverlay.addEventListener('click', closeSidebar);
        }

        // Optional: Close sidebar on Escape key press
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape' && mainMenuSidebar && mainMenuSidebar.classList.contains('open')) {
                closeSidebar();
            }
        });

        // Untuk Bootstrap Toggler (jika masih digunakan untuk auth/user dropdown di mobile)
        // Pastikan ID navbarAuthContent unik dan tidak sama dengan ID sidebar
        const authToggler = document.querySelector('[data-bs-target="#navbarAuthContent"]');
        const authCollapse = document.getElementById('navbarAuthContent');

        if(authToggler && authCollapse){
            // Anda mungkin perlu event listener manual jika ada konflik dengan sidebar
            // Atau biarkan Bootstrap JS menanganinya.
        }
    });
</script>